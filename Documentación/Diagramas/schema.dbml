// ZFC C√≥cteles - Esquema de Base de Datos
// Generado para visualizaci√≥n de diagramas ER

Project ZFCCocteles {
  database_type: 'SQLite'
  Note: '''
    # ZFC C√≥cteles Database Schema
    Sistema de gesti√≥n de c√≥cteles con funcionalidades avanzadas:
    - Gesti√≥n de usuarios y categor√≠as personalizadas
    - Recetas detalladas con pasos e ingredientes
    - Historial de preparaci√≥n con m√©tricas
    - Sistema de notificaciones
    - Configuraci√≥n personalizable

    üîÑ √öLTIMA ACTUALIZACI√ìN: Julio 2025
    ‚úÖ Sincronizado con implementaci√≥n en schema.sql
    üéØ Incluye sistema de favoritos por categor√≠as (superior)
  '''
}

// ================================
// ENTIDADES PRINCIPALES
// ================================

Table users {
  id integer [primary key, increment, note: 'ID √∫nico del usuario']
  username text [unique, not null, note: 'Nombre de usuario √∫nico']
  email text [unique, not null, note: 'Email √∫nico para login']
  password text [not null, note: 'Contrase√±a encriptada']
  created_at text [default: `datetime('now')`, note: 'Fecha de registro']
  updated_at text [default: `datetime('now')`, note: '√öltima actualizaci√≥n']

  Note: 'Usuarios del sistema - pueden crear c√≥cteles y categor√≠as'
}

Table categories {
  id integer [primary key, increment]
  name text [unique, not null, note: 'Nombre √∫nico de la categor√≠a']
  description text [note: 'Descripci√≥n opcional']
  color text [default: '#6B7280', note: 'Color hexadecimal para la UI']
  is_system integer [default: 0, note: '1=categor√≠a del sistema (Favoritos, Recientes), 0=personalizada']
  id_owner integer [ref: > users.id, note: 'Usuario creador (NULL para categor√≠as del sistema)']
  created_at text [default: `datetime('now')`]
  updated_at text [default: `datetime('now')`]

  Note: '''
    Categor√≠as de c√≥cteles - pueden ser:
    - Sistema: Favoritos, Recientes, Por Probar
    - Personalizadas: Creadas por usuarios
  '''
}

Table pairings {
  id integer [primary key, increment]
  name text [not null, note: 'Nombre del maridaje']
  description text [note: 'Descripci√≥n del tipo de ocasi√≥n']
  created_at text [default: `datetime('now')`]

  Note: 'Tipos de maridaje: Aperitivo, Digestivo, Celebraci√≥n, etc.'
}

Table cocktails {
  id integer [primary key, increment]
  name text [unique, not null, note: 'Nombre √∫nico del c√≥ctel']
  img_url text [note: 'URL de la imagen del c√≥ctel']
  difficulty text [not null, note: 'Dificultad: f√°cil, media, dif√≠cil']
  description text [note: 'Descripci√≥n del c√≥ctel']
  additional_notes text [note: 'Notas adicionales']
  preparation_time integer [note: 'Tiempo estimado en minutos (CHECK > 0)']
  servings integer [default: 1, note: 'N√∫mero de porciones (CHECK > 0)']
  alcohol_content real [note: 'Porcentaje de alcohol (CHECK 0-100)']
  is_featured integer [default: 0, note: '1=destacado en la app, 0=normal']
  id_owner integer [ref: > users.id, note: 'Usuario creador']
  id_pairing integer [ref: > pairings.id, note: 'Maridaje principal']
  created_at text [default: `datetime('now')`]
  updated_at text [default: `datetime('now')`]

  Note: '''
    Entidad central del sistema.
    Las categor√≠as se manejan √öNICAMENTE via cocktail_categories (N:M)
    - Elimina redundancia de id_category
    - Soporta m√∫ltiples categor√≠as por c√≥ctel
    - M√°s flexible y normalizado
    
    ‚úÖ VALIDACIONES MEJORADAS:
    - preparation_time > 0
    - servings > 0  
    - alcohol_content BETWEEN 0 AND 100
  '''
}

// ================================
// RECETAS Y PREPARACI√ìN
// ================================

Table recipes {
  id integer [primary key, increment]
  id_cocktail integer [unique, not null, ref: - cocktails.id, note: 'Relaci√≥n 1:1 con c√≥ctel']
  glass_type text [note: 'Tipo de vaso: highball, martini, rocks, etc.']
  garnish text [note: 'Decoraci√≥n: rodaja de lima, cereza, etc.']
  serving_suggestion text [note: 'Sugerencias de servido']
  created_at text [default: `datetime('now')`]
  updated_at text [default: `datetime('now')`]

  Note: 'Recetas - informaci√≥n de preparaci√≥n y presentaci√≥n'
}

Table recipe_steps {
  id integer [primary key, increment]
  id_recipe integer [not null, ref: > recipes.id, note: 'Receta a la que pertenece']
  step_number integer [not null, note: 'N√∫mero de paso (1, 2, 3...) CHECK > 0']
  instruction text [not null, note: 'Instrucci√≥n detallada del paso']
  duration integer [note: 'Tiempo estimado del paso en segundos (CHECK > 0)']
  is_critical integer [default: 0, note: '1=paso cr√≠tico, 0=opcional']
  created_at text [default: `datetime('now')`]

  Note: '''
    Pasos ordenados de preparaci√≥n - permite instrucciones detalladas
    ‚úÖ VALIDACIONES: step_number > 0, duration > 0
  '''
}

Table ingredients {
  id integer [primary key, increment]
  name text [unique, not null, note: 'Nombre √∫nico del ingrediente']
  type text [not null, note: 'Tipo: esencial, opcional']
  category text [note: 'Categor√≠a: alcohol, mixer, fruta, hierba, etc.']
  description text [note: 'Descripci√≥n del ingrediente']
  alcohol_content real [default: 0, note: 'Porcentaje de alcohol (CHECK 0-100)']
  created_at text [default: `datetime('now')`]

  Note: '''
    Ingredientes base - sin cantidades (esas van en recipe_ingredients)
    ‚úÖ VALIDACI√ìN: alcohol_content BETWEEN 0 AND 100
  '''
}

// ================================
// RELACIONES N:M
// ================================

Table recipe_ingredients {
  id_recipe integer [not null, ref: > recipes.id, note: 'Receta']
  id_ingredient integer [not null, ref: > ingredients.id, note: 'Ingrediente']
  quantity real [not null, note: 'Cantidad num√©rica (50, 30, 2...)']
  unit text [not null, note: 'Unidad: ml, oz, cucharadas, gotas, etc.']
  preparation_note text [note: 'Preparaci√≥n: machacado, en cubos, exprimido, etc.']
  is_optional integer [default: 0, note: '1=opcional en esta receta, 0=obligatorio']
  order_index integer [default: 0, note: 'Orden de agregado en la receta']

  indexes {
    (id_recipe, id_ingredient) [pk]
  }

  Note: '''
    Relaci√≥n N:M ingredientes-recetas con detalles:
    - Cantidad espec√≠fica por receta
    - Preparaci√≥n espec√≠fica
    - Orden de agregado
  '''
}

Table cocktail_categories {
  id_cocktail integer [not null, ref: > cocktails.id, note: 'C√≥ctel']
  id_category integer [not null, ref: > categories.id, note: 'Categor√≠a']
  added_at text [default: `datetime('now')`, note: 'Cu√°ndo se agreg√≥ a la categor√≠a']

  indexes {
    (id_cocktail, id_category) [pk]
  }

  Note: 'Relaci√≥n N:M c√≥cteles-categor√≠as - un c√≥ctel puede estar en m√∫ltiples categor√≠as'
}

// ================================
// HISTORIAL Y AN√ÅLISIS
// ================================

Table preparation_history {
  id integer [primary key, increment]
  id_user integer [not null, ref: > users.id, note: 'Usuario que prepar√≥']
  id_cocktail integer [not null, ref: > cocktails.id, note: 'C√≥ctel preparado']
  preparation_date text [not null, default: `datetime('now')`, note: 'Fecha de preparaci√≥n']
  score integer [default: 0, note: 'Calificaci√≥n 0-5 estrellas (CHECK BETWEEN 0 AND 5)']
  comment text [note: 'Comentario del usuario']
  preparation_time integer [note: 'Tiempo REAL de preparaci√≥n en minutos (CHECK > 0)']
  difficulty_experienced text [note: 'Dificultad PERCIBIDA: f√°cil, media, dif√≠cil']
  would_make_again integer [default: 1, note: '1=s√≠ lo repetir√≠a, 0=no']
  created_at text [default: `datetime('now')`]

  Note: '''
    Historial detallado de preparaciones:
    - Captura experiencia real vs te√≥rica
    - M√©tricas para recomendaciones
    - An√°lisis de mejora del usuario
    ‚úÖ VALIDACI√ìN: preparation_time > 0
  '''
}

// ================================
// SISTEMA DE NOTIFICACIONES
// ================================

Table notifications {
  id integer [primary key, increment]
  id_user integer [ref: > users.id, note: 'Usuario destinatario (NULL=notificaci√≥n global)']
  type text [not null, note: 'Tipo: actualizacion, advertencia, logro, recordatorio']
  title text [not null, note: 'T√≠tulo de la notificaci√≥n']
  message text [not null, note: 'Mensaje detallado']
  is_read integer [default: 0, note: '1=le√≠da, 0=no le√≠da']
  is_system integer [default: 0, note: '1=notificaci√≥n del sistema, 0=personalizada']
  related_cocktail_id integer [ref: > cocktails.id, note: 'C√≥ctel relacionado (opcional)']
  created_at text [default: `datetime('now')`, note: 'Fecha de creaci√≥n']
  read_at text [note: 'Fecha de lectura']

  Note: '''
    Sistema de notificaciones:
    - Actualizaciones de app
    - Logros y recordatorios
    - Advertencias de seguridad
    - Notificaciones personalizadas
  '''
}

// ================================
// CONFIGURACI√ìN
// ================================

Table user_settings {
  id integer [primary key, increment]
  id_user integer [unique, not null, ref: - users.id, note: 'Relaci√≥n 1:1 con usuario']
  theme text [default: 'light', note: 'Tema: light, dark, auto']
  notifications_enabled integer [default: 1, note: '1=habilitadas, 0=deshabilitadas']
  inventory_reminders integer [default: 1, note: '1=recordatorios de inventario activos']
  default_serving_size integer [default: 1, note: 'Tama√±o de porci√≥n por defecto (CHECK > 0)']
  preferred_units text [default: 'ml', note: 'Unidades preferidas: ml, oz']
  created_at text [default: `datetime('now')`]
  updated_at text [default: `datetime('now')`]

  Note: '''
    Configuraci√≥n personalizada por usuario
    ‚úÖ VALIDACI√ìN: default_serving_size > 0
  '''
}

// ================================
// √çNDICES PARA PERFORMANCE
// ================================

// √çndices principales para optimizaci√≥n de consultas (IMPLEMENTADOS)
CREATE INDEX IF NOT EXISTS idx_cocktails_difficulty ON cocktails(difficulty);
CREATE INDEX IF NOT EXISTS idx_cocktails_owner ON cocktails(id_owner);
CREATE INDEX IF NOT EXISTS idx_preparation_history_user ON preparation_history(id_user);
CREATE INDEX IF NOT EXISTS idx_preparation_history_date ON preparation_history(preparation_date);
CREATE INDEX IF NOT EXISTS idx_notifications_user_unread ON notifications(id_user, is_read);
CREATE INDEX IF NOT EXISTS idx_recipe_steps_recipe ON recipe_steps(id_recipe, step_number);
CREATE INDEX IF NOT EXISTS idx_cocktail_categories_cocktail ON cocktail_categories(id_cocktail);
CREATE INDEX IF NOT EXISTS idx_cocktail_categories_category ON cocktail_categories(id_category);

// ================================
// √çNDICES PARA OPTIMIZACI√ìN
// ================================

Indexes {
  // B√∫squedas por nombre de c√≥ctel
  idx_cocktails_name: cocktails.name

  // B√∫squedas por ingrediente
  idx_cocktail_ingredients_ingredient: cocktail_ingredients.id_ingredient

  // B√∫squedas por categor√≠a  
  idx_cocktail_categories_category: cocktail_categories.id_category

  // B√∫squedas por usuario
  idx_cocktails_user: cocktails.id_user
  idx_inventory_user: user_inventory.id_user
  idx_preparation_history_user: preparation_history.id_user
}

// ================================
// ENUMS Y CONSTRAINTS
// ================================

Enum difficulty_levels {
  f√°cil [note: 'F√°cil de preparar']
  media [note: 'Dificultad media']
  dif√≠cil [note: 'Dif√≠cil - requiere experiencia']
}

Enum notification_types {
  actualizacion [note: 'Nuevas versiones y caracter√≠sticas']
  advertencia [note: 'Advertencias de seguridad']
  logro [note: 'Logros y celebraciones']
  recordatorio [note: 'Recordatorios de inventario']
}

Enum theme_options {
  light [note: 'Tema claro']
  dark [note: 'Tema oscuro']
  auto [note: 'Autom√°tico seg√∫n sistema']
}

Enum unit_preferences {
  ml [note: 'Mililitros (m√©trico)']
  oz [note: 'Onzas (imperial)']
}